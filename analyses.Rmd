---
title: "childes_weird"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

https://rpubs.com/gloukatou/733656

## R Markdown

```{r libraries, message=FALSE, warning=FALSE}
#library(childesr)
#library(wordbankr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(purrr)
require(scales)
library(stringr)
library(kableExtra)


library(RColorBrewer)
myPalette <- brewer.pal(5, "Set2") 


group_count <-function(data_, column_){
data_<- data_ %>%
  group_by({{column_}}) %>%
    count() 
      return(data_)
}

group_select<-function(data_, column_){
data_ <- data_%>%
    group_by(!!column_) %>%
      select(Corpus, !!column_)
data_ <- data_[ order( data_[,3] ),]
return(data_)
}
```

# Load annotations 

```{r load annotations}

#####TODOS first part is the descriptive section, to what extent the full range of populations is represented, what are some codes that are missing often,
##### descriptive section and representation of the population
##########systematic review of features
##################confront eg proportion of child population versus proportion of data by eg continent
#############second goal: point out strengths and limitations of the current CHILDES, explain what is missing

annotations<- read.csv("Table for authors - annotations.csv") 
colnames(annotations)[colnames(annotations)=="X..of.children.with.siblings"]<-"Nb.of.children.with.siblings"
colnames(annotations)[colnames(annotations)=="X..of.children.with.older.siblings"]<-"Nb.of.children.with.older.siblings"
colnames(annotations)=gsub("\\.\\..*","",colnames(annotations))
colnames(annotations)[colnames(annotations)=="Our.coding.of"]<-"Our.coding.of.community.type"

annotations$Number.of.participants[annotations$Number.of.participants=="1 or 5"]<-NA
annotations$Number.of.participants[annotations$Number.of.participants=="1 CHI + MOT/FAT/INV"]<-1
annotations$Number.of.participants[annotations$Number.of.participants=="4 CHI + MOTs, some FATs, some SIBs"]<-4
annotations$Number.of.participants=as.numeric(as.character(annotations$Number.of.participants))

```

`r nrow(annotations)` corpora annotated. 



```{r group_by inclusion}

include<- annotations %>%
  mutate(inclusion=tolower(Inclusion)) %>%
  mutate(inclusion = ifelse(str_detect(inclusion, "yes"), "yes", "no")) %>%
  group_by(inclusion) %>%
  count() 

ggplot(include,aes(y=n, x=inclusion)) +
  geom_bar(stat="identity", width=1, color="white") +
  theme_minimal() + 
  ggtitle("Corpus inclusion") 

annotations <- annotations %>%
  filter(Inclusion=="yes")

```
From the total amount of corpora, `r nrow(annotations)` have been included in this study. The following analyses will continue only on these included corpora.


```{r group_by location_cleaning}

annotations$continent <-NA

annotations$continent[grep("England|Sweden|Spain|Madrid, Spain ; Tenerife, Canary Islands|Madrid, Spain|Navarra, Spain|Estonia|Tartu, Estonia ; Rapla, Estonia|Budapest, Hungary|West Coast, Ireland|Arfon area Gwynedd, North Wales|Netherlands|Belfast, Northern Ireland|Nottingham/Manchester, England|Sweden ; Portugal|Czech Republic|Bucharest, Romania|Postdam, Germany|Stuttgart, Germany|France|Alt penedes, region of catalonia|spain|Naples|Spain, Hungary, Lloret de mar|Spain, Salamanca|England, Brighton|France (Normandy, Marseille, + places visited)|Portugal|italy|Barcelona|Switzerland|Stockholm, Sweden|Iceland|Poznań, Poland|Romania|Antwerp, Belgium|Ireland|Hungary|Athens, Greece|Southern Estonia|Tartu, Estonia|A Coruña, Santiago de Compostela ; Lugo ; Pontevedra, A Estrada ; SPAIN|Moscow, Russia|Spain, Salamanca|Wales", annotations$Location)]  <- "Europe"

annotations$continent[grep("Rio Cuarto, Cordoba, Argentina|Sao Paulo|Patzcuaro, Michoacan, iMexico|Jamaica", annotations$Location)]  <- "Central and South America"

annotations$continent[grep("Iran|Israel|Bombay, India|China|Bangkok, Thailand|Tokyo area|Nagoya area|osaka area|Kuwait|Yahud, Israel|Nagoya center|Kusatsu City, Shiga Pref|Hong-Kong|Taiwan|Turkey", annotations$Location)]  <- "Asia"

annotations$continent[grep("Michigan, USA|USA, Northern Virginia|Canada|California, USA|washington dc|United States|USA", annotations$Location)]  <- "North America"

annotations$continent[grep("Alexandria, Egypt|Mokhotlong, Lesotho", annotations$Location)]  <- "Africa"


annotations$country <-NA
annotations$country[grep("England|West Coast, Ireland|Arfon area Gwynedd, North Wales|Belfast, Northern Ireland|Nottingham/Manchester, England|England, Brighton|Ireland|Wales", annotations$Location)]  <- "UK/Ireland"
annotations$country[grep("Sweden|Sweden ; Portugal|Stockholm, Sweden", annotations$Location)]  <- "Sweden"
annotations$country[grep("Spain|Madrid, Spain ; Tenerife, Canary Islands|Madrid, Spain|Navarra, Spain|Alt penedes, region of catalonia|spain|Spain, Hungary, Lloret de mar|Spain, Salamanca|Barcelona|A Coruña, Santiago de Compostela ; Lugo ; Pontevedra, A Estrada ; SPAIN|Spain, Salamanca", annotations$Location)]  <- "Spain"
annotations$country[grep("Estonia|Tartu, Estonia ; Rapla, Estonia|Southern Estonia|Tartu, Estonia", annotations$Location)]  <- "Estonia"
annotations$country[grep("Budapest, Hungary|Hungary|Spain, Hungary, Lloret de mar", annotations$Location)]  <- "Hungary"
annotations$country[grep("Sweden ; Portugal|Portugal", annotations$Location)]  <- "Portugal"
annotations$country[grep("Czech Republic", annotations$Location)]  <- "Czech Republic"
annotations$country[grep("Bucharest, Romania|Romania", annotations$Location)]  <- "Romania"
annotations$country[grep("Postdam, Germany|Stuttgart, Germany", annotations$Location)]  <- "Germany"
annotations$country[grep("France|France (Normandy, Marseille, + places visited)", annotations$Location)]  <- "France"
annotations$country[grep("Naples|italy", annotations$Location)]  <- "Italy"
annotations$country[grep("Switzerland", annotations$Location)]  <- "Switzerland"
annotations$country[grep("Iceland", annotations$Location)]  <- "Iceland"
annotations$country[grep("Poznań, Poland", annotations$Location)]  <- "Poland"
annotations$country[grep("Antwerp, Belgium", annotations$Location)]  <- "Belgium"
annotations$country[grep("Athens, Greece", annotations$Location)]  <- "Greece"
annotations$country[grep("Moscow, Russia", annotations$Location)]  <- "Russia"
annotations$country[grep("Rio Cuarto, Cordoba, Argentina", annotations$Location)]  <- "Argentina"
annotations$country[grep("Sao Paulo", annotations$Location)]  <- "Brazil"
annotations$country[grep("Patzcuaro, Michoacan, iMexico", annotations$Location)]  <- "Mexico"
annotations$country[grep("Jamaica", annotations$Location)]  <- "Jamaica"
annotations$country[grep("Iran", annotations$Location)]  <- "Iran"
annotations$country[grep("Israel|Yahud, Israel", annotations$Location)]  <- "Israel"
annotations$country[grep("Bombay, India", annotations$Location)]  <- "India"
annotations$country[grep("China", annotations$Location)]  <- "China"
annotations$country[grep("Bangkok, Thailand", annotations$Location)]  <- "Thailand"
annotations$country[grep("Tokyo area|Nagoya area|osaka area|Nagoya center|Kusatsu City, Shiga Pref", annotations$Location)]  <- "Japan"
annotations$country[grep("Kuwait", annotations$Location)]  <- "Kuwait"
annotations$country[grep("Hong-Kong", annotations$Location)]  <- "Hong-Kong"
annotations$country[grep("Taiwan", annotations$Location)]  <- "Taiwan"
annotations$country[grep("Turkey", annotations$Location)]  <- "Turkey"
annotations$country[grep("Michigan, USA|USA, Northern Virginia|California, USA|washington dc|United States|USA", annotations$Location)]  <- "USA"
annotations$country[grep("Canada", annotations$Location)]  <- "Canada"
annotations$country[grep("Alexandria, Egypt", annotations$Location)]  <- "Egypt"
annotations$country[grep("Mokhotlong, Lesotho", annotations$Location)]  <- "Lesotho"

```

```{r cleaning type}

annotations$Type.of.community.at.the.time.of.the.recordings[is.na(annotations$Type.of.community.at.the.time.of.the.recordings)]<-annotations$Our.coding.of.community.type[is.na(annotations$Type.of.community.at.the.time.of.the.recordings)]

annotations$Type.of.community.at.the.time.of.the.recordings[annotations$Type.of.community.at.the.time.of.the.recordings %in% c("academic","capital city of the Soviet Union","city","industial","industrial ",
                                                                                                                               "industrial & service &trade activities...","industrial city (3.000.000 inhabitants",
                                                                                                                               "Industrial city (population: around 272,000 inhabitants)",
                                                                                                                               "Mediterranean city of 1.6 million inhabitants",
                                                                                                                               "modern city families, usually both working parents",
                                                                                                                               "Orthodox Jews",
                                                                                                                               "Seaside tourist town",
                                                                                                                               "work-for-pay/industrial")]<-"urban"

annotations$Type.of.community.at.the.time.of.the.recordings[annotations$Type.of.community.at.the.time.of.the.recordings %in% c("farmer","rural","rural farming village")]<-"rural"

annotations$Type.of.community.at.the.time.of.the.recordings[annotations$Type.of.community.at.the.time.of.the.recordings %in% c("industrial, farmers")]<-"both"
```



```{r ancillary data}
byPart<- annotations %>%
  select(Language.or.Languages.spoken.in.recordings, Number.of.participants) %>%
   filter(!is.na(Number.of.participants)) %>%
     group_by(Language.or.Languages.spoken.in.recordings) %>%
       summarise(numpar = sum(as.numeric(Number.of.participants))) 
```

# At the level of the population

## Western

There are corpora for every continent, although more corpora in Europe than other continents:

```{r tab x cont}
kable(table(annotations$continent))

```


```{r nch x cont}
mytab=aggregate(annotations$Number.of.participants,by=list(annotations$continent),sum)
colnames(mytab)<-c("Continent","Number of children")
kable(mytab)

```
## Educated

await cleaning

```{r}

```


## Urban versus rural

```{r tab x rur/urb}
kable(table(annotations$Type.of.community.at.the.time.of.the.recordings))

```


```{r nch x rur/urb}
mytab=aggregate(annotations$Number.of.participants,by=list(annotations$Type.of.community.at.the.time.of.the.recordings),sum)
colnames(mytab)<-c("Setting","Number of children")
kable(mytab)

```


## Rich

## Democratic


## Monolingualism

```{r group_by bilinguals_community}
annotations$Bilingualism.Multilingualism.in.community[annotations$Bilingualism.Multilingualism.in.community %in% c(" yes (bilingualism Galician-Spanish)","bilingual (Arabic/English)","probably","Yes (Spanish/Catalan)")] <- "yes"
annotations$Bilingualism.Multilingualism.in.community[annotations$Bilingualism.Multilingualism.in.community %in% c("Minimal","slight","yes (but minimal)","only for Jong, other monolinguals")] <- "minimal"
annotations$Bilingualism.Multilingualism.in.community<-tolower(annotations$Bilingualism.Multilingualism.in.community)
annotations$Bilingualism.Multilingualism.in.community[annotations$Bilingualism.Multilingualism.in.community==""]<-NA

byBilinguals<-group_count(annotations, Bilingualism.Multilingualism.in.community)

ggplot(byBilinguals,aes(y=n, x=Bilingualism.Multilingualism.in.community)) +
  geom_bar(stat="identity", width=1, color="white") +
  theme_minimal() + 
  ggtitle("Bilingualism in the community") 



```


# At the level of the family

## Education

### Based on "Parental.education, Parental.profession" annotation columns

```{r group_by educ}

byParentEducation<- annotations[!is.na(annotations$Parental.education),] %>%
    group_by(Language.or.Languages.spoken.in.recordings, continent, Parental.education) %>%
      count() 

byParentEducation <- byParentEducation %>% 
  rename(
    number_of_corpora = n,
    Parental.education.NAs_excluded = Parental.education)

byParentEducation

```
`r nrow(annotations[annotations$Parental.education==NA,])` corpora have NA for parental education.



### Based on "Parental.ses" annotation column
```{r group_by ses}

byParentSES<- annotations[!is.na(annotations$Parental.socioeconomic.status),] %>%
    group_by(Language.or.Languages.spoken.in.recordings, continent, Parental.socioeconomic.status) %>%
      count() 

byParentSES <- byParentSES %>% 
  rename(
    number_of_corpora = n,
    Parental.socioeconomic.status.NAs_excluded = Parental.socioeconomic.status)

byParentSES 

```
`r nrow(annotations[annotations$Parental.socioeconomic.status==NA,])` corpora have NA for parental education.


```{r group_by prof}
byParentProfession<- annotations[!is.na(annotations$Parental.profession),] %>%
    group_by(Language.or.Languages.spoken.in.recordings, continent, Parental.profession) %>%
      count() 

byParentProfession <- byParentProfession %>% 
  rename(
    number_of_corpora = n,
    Parental.profession.NAs_excluded = Parental.profession)

byParentProfession

annotations %>%
  group_by(Parental.education) %>%
  filter(is.na(Parental.education)) %>%
  summarise(count=n())

```


## Household structure

## Siblings
#### Based on "Number of children with siblings" annotation column
##### How many of the target children have siblings?

```{r group_by Nb.of.children.with.siblings, warning=FALSE, message=FALSE}
#d[is.na(d)] <- 0

bySibl<- annotations %>%
  select(Language.or.Languages.spoken.in.recordings,Nb.of.children.with.siblings) %>%
   # mutate(child_sibl = ifelse(is.na(Nb.of.children.with.siblings), 0, Nb.of.children.with.siblings )) %>%
     group_by(Language.or.Languages.spoken.in.recordings) %>%
      summarise(numpar_sibl = sum(as.numeric(Nb.of.children.with.siblings), na.rm=TRUE)) 
#     pivot_longer(c(numpar_sibl, numpar), names_to = "type", values_to = "value")
                    

ggplot(bySibl[order(bySibl$Language.or.Languages.spoken.in.recordings),], aes(y=Language.or.Languages.spoken.in.recordings, x=numpar_sibl)) + 
    geom_col() 

ggplot(bySibl[!is.na(bySibl$numpar_sibl),], mapping = aes(y=Language.or.Languages.spoken.in.recordings, x=numpar_sibl)) + 
  geom_point() + 
    ggtitle("Languages where number of children with siblings is not unknown") + 
      geom_col()

bySibl<- annotations %>%
  select(Language.or.Languages.spoken.in.recordings,Nb.of.children.with.siblings) %>%
   # mutate(child_sibl = ifelse(is.na(Nb.of.children.with.siblings), 0, Nb.of.children.with.siblings )) %>%
     group_by(Language.or.Languages.spoken.in.recordings) %>%
      summarise(numpar_sibl = sum(as.numeric(Nb.of.children.with.siblings))) 
#     pivot_longer(c(numpar_sibl, numpar), names_to = "type", values_to = "value")
                 

```
Out of `r sum(byPart$numpar, na.rm=TRUE)` total target children, only `r sum(bySibl$numpar_sibl, na.rm =TRUE)` have siblings. No information for children in `r nrow(annotations %>% filter(is.na(Nb.of.children.with.siblings)))` corpora and `r nrow(bySibl %>% filter(is.na(numpar_sibl)))` languages (marked as NAs).

## Languages


### Based on "Average number of siblings" annotation column
#### How many siblings in average?
```{r group_by siblings, warning=FALSE, message=FALSE}

bySiblnum<-annotations %>%
    group_by(Average.number.of.siblings) %>%
      count()

ggplot(bySiblnum, mapping = aes(x=Average.number.of.siblings, y=n)) + 
  geom_point() + 
    ggtitle("Average number of siblings per corpus") + 
      geom_col()

#ggplot(bySiblnum[!is.na(bySiblnum$Average.number.of.siblings),], mapping = aes(x=Average.number.of.siblings, y=n)) 

annotations$Average.number.of.siblings <- as.numeric(as.character(annotations$Average.number.of.siblings))
head(bySiblnum)
```
The mean number of  siblings has been left NA for `r bySiblnum[is.na(bySiblnum$Average.number.of.siblings),]$n` out of `r sum(bySiblnum$n)` corpora. In the remaining corpora, the mean number of siblings per corpus is `r mean(annotations[!is.na(annotations$Average.number.of.siblings),]$Average.number.of.siblings, na.rm=TRUE)` with min `r min(annotations[!is.na(annotations$Average.number.of.siblings),]$Average.number.of.siblings)` and max `r max(annotations[!is.na(annotations$Average.number.of.siblings),]$Average.number.of.siblings)`.


### Based on "Average number of older siblings" annotation column
#### How many older siblings in average?
```{r group_by old_siblings, warning=FALSE, message=FALSE}

byoldSiblnum<-annotations %>%
    group_by(Average.number.of.older.siblings) %>%
      count()

ggplot(byoldSiblnum, mapping = aes(x=Average.number.of.older.siblings, y=n)) + 
  geom_point() + 
    ggtitle("Average number of older siblings per corpus") + 
      geom_col()

annotations$Average.number.of.older.siblings <- as.numeric(as.character(annotations$Average.number.of.older.siblings))

head(byoldSiblnum)
```

The mean number of older siblings has been left NA for `r byoldSiblnum[is.na(byoldSiblnum$Average.number.of.older.siblings),]$n` out of `r sum(byoldSiblnum$n)` corpora.  In the remaining corpora, the mean number of older siblings per corpus is `r mean(annotations[!is.na(annotations$Average.number.of.older.siblings),]$Average.number.of.older.siblings, na.rm=TRUE)` with min `r min(annotations[!is.na(annotations$Average.number.of.older.siblings),]$Average.number.of.siblings)` and max `r max(annotations[!is.na(annotations$Average.number.of.older.siblings),]$Average.number.of.older.siblings)`.

## Bilingualism

```{r group_by bilinguals}

annotations$Bilingualism.Multilingualism.in.family[annotations$Bilingualism.Multilingualism.in.family %in% c("1 Portuguese-French; 1 Russian-French","participants were included as en or fr when their language exposure across settings consisted of 75% or more of the respective language by parent report")]<-"all"
annotations$Bilingualism.Multilingualism.in.family[annotations$Bilingualism.Multilingualism.in.family %in% c("only for Jong, other monolinguals","1")]<-"some"
annotations$Bilingualism.Multilingualism.in.family<-tolower(annotations$Bilingualism.Multilingualism.in.family)
annotations$Bilingualism.Multilingualism.in.family[grep("yes",annotations$Bilingualism.Multilingualism.in.family)]<-"all"
annotations$Bilingualism.Multilingualism.in.family[grep("bilingual",annotations$Bilingualism.Multilingualism.in.family)]<-"all"
annotations$Bilingualism.Multilingualism.in.family[grep("no",annotations$Bilingualism.Multilingualism.in.family)]<-"none"
annotations$Bilingualism.Multilingualism.in.family[annotations$Bilingualism.Multilingualism.in.family=="parents are linguists; fluent in spanish, do field work on turkish, mayan languages, possibly more."]<-"none"
annotations$Bilingualism.Multilingualism.in.family[annotations$Bilingualism.Multilingualism.in.family %in% c("","unknown","?")]<-NA

byBilinguals<-group_count(annotations, Bilingualism.Multilingualism.in.family)

ggplot(byBilinguals,aes(y=n, x=Bilingualism.Multilingualism.in.family)) +
  geom_bar(stat="identity", width=1, color="white") +
  theme_minimal() + 
  ggtitle("Bilingualism in family") 


```





# Old information



## Based on "Fertility.rate.of.community.at.the.time.of.the.recordings, Interbirth intervals, Schooling, Community, Healty, Culture, Mortality, Household..." annotation columns
### Mostly NAs. For now just prints column 

```{r group_by weird_var, warning=FALSE, message=FALSE}

byFertility <- group_select(annotations, "Fertility.rate.of.community.at.the.time.of.the.recordings")
byFertility <- byFertility %>% group_by(Fertility.rate.of.community.at.the.time.of.the.recordings) %>%  summarise(n = n())
byFertility
```

```{r group_by weird_var2, warning=FALSE, message=FALSE}

byInterbirth <- group_select(annotations, "Interbirth.intervals.in.community.at.the.time.of.the.recordings")
byInterbirth <- byInterbirth %>% group_by(Interbirth.intervals.in.community.at.the.time.of.the.recordings) %>%  summarise(n = n())
byInterbirth

bySchooling <- group_select(annotations, "Access.to.schooling.for.recorded.children")
bySchooling <- bySchooling %>% group_by(Access.to.schooling.for.recorded.children) %>%  summarise(n = n())
bySchooling

byCommunity <- group_select(annotations, "Type.of.community.at.the.time.of.the.recordings")
byCommunity <- byCommunity %>% group_by(Type.of.community.at.the.time.of.the.recordings) %>%  summarise(n = n())
byCommunity

byHealth <- group_select(annotations, "Access.to.health.service.for.recorded.children")
byHealth <- byHealth %>% group_by(Access.to.health.service.for.recorded.children) %>%  summarise(n = n())
byHealth 

#byCulture <- group_select(annotations, "type_culture")
#byCulture <- byCulture %>% group_by(Type.of.culture..minority..majority.) %>%  summarise(n = n())
#byCulture

#byMortality<- group_select(annotations, "Mortality.rate.of.children.in.the.community")
#byMortality<- byMortality %>% group_by(Mortality.rate.of.children.in.the.community) %>%  summarise(n = n())
#byMortality

byLangSpeakers<- group_select(annotations, "Number.of.speakers.of.the.language")
byLangSpeakers<- byLangSpeakers %>% group_by(Number.of.speakers.of.the.language) %>%  summarise(n = n())
byLangSpeakers

byHousehold<- group_select(annotations, "Household.structure")
byhousehold<- byHousehold %>% group_by(Household.structure) %>%  summarise(n = n())
byhousehold

#byTimespent<- group_select(annotations, #"Where.children.spend.their.time..home..nursery..playing.by.the.river....")
#byTimespent<- byTimespent %>% #group_by(Where.children.spend.their.time..home..nursery..playing.by.the.river....) %>%  summarise(n = n())
#byTimespent

```



### Location 
Based on "Location" annotation column
For now only based on continents and countries. Lots of handcoding.



### Corpora by countries and continents
```{r group_by Location}

byLocation <- annotations %>%
  select(country, continent) %>%
    group_by(country, continent) %>%
      count()

ggplot(byLocation, aes(x=n, y=country)) +
  geom_bar(stat="identity", width=1, color="white") +
    ggtitle("Corpora by Countries and Continents") +
      facet_wrap(~continent, scale="free") 

head(byLocation)

```

`r length(unique(byLocation$country))` countries are represented in childes. `r length(unique(byLocation$continent))-1` continents. 
`r nrow(annotations[annotations$continent=="Europe",])` of the `r nrow(annotations)` corpora are European, and
`r nrow(annotations[annotations$continent=="North America",])` of the corpora are North American. 

## Based on "Location" annotation column
### Corpora by countries and continents
```{r group_by location1}
byLocation1 <- group_count(annotations, continent)
lbls <- paste(byLocation1$continent, byLocation1$n, sep=" ") # add numbers to labels
pie(byLocation1$n, labels=lbls, border="white", col=myPalette, main="Corpora by continent")

head(byLocation1)

```


## Recording age
### Based on "Mean.child.age.at.beginning.of.recordings, Mean.child.age.at.end.of.recordings" annotation columns

This chunk not working because it uses old column naming convention, and Alex thought it should be replaced with something that draws age from the .cha, rather than human inputting.

```{r group_by age, warning=FALSE, message=FALSE, eval=F}
byAge <- annotations %>% 
 select(first_age, last_age, country, continent) %>%
  group_by(country, continent) %>%
    summarize(min = min(first_age), max = max(last_age)) %>%
       arrange(desc(min)) 


ggplot(byAge, aes(y=country))+
  geom_linerange(aes(xmin=min,xmax=max),linetype=2,color="blue")+
    geom_point(aes(x=min),size=3,color="red")+
      geom_point(aes(x=max),size=3,color="red")+
        ggtitle("Nim and Max age per country") +
          theme_bw()+
             facet_wrap(~continent, scale="free") 
            
```





## Number of children in CHILDES
### Based on "Number.of.participants" annotation column
#### Number of target children per language

```{r group_by participants}

byPart<- annotations %>%
  select(Language.or.Languages.spoken.in.recordings, Number.of.participants, Bilingualism.Multilingualism.in.corpus) %>%
   filter(!is.na(Number.of.participants)) %>%
     group_by(Language.or.Languages.spoken.in.recordings, Bilingualism.Multilingualism.in.corpus) %>%
       summarise(numpar = sum(as.numeric(Number.of.participants))) 
#     p

byPart %>%      
  ggplot(mapping = aes(y = reorder(Language.or.Languages.spoken.in.recordings, numpar), numpar)) + 
    geom_point() + 
      ggtitle("Number of target children per language") + 
        geom_col()+ 
          facet_wrap(~Bilingualism.Multilingualism.in.corpus, scale="free") +
            labs(y= "Languages", x = "Number of target children")

byPart_nona <- byPart[!is.na(byPart$Bilingualism.Multilingualism.in.corpus),]
byPart_mono <- byPart_nona %>%
  filter(Bilingualism.Multilingualism.in.corpus=="Monolinguals")
byPart_bili <- byPart_nona %>%
  filter(Bilingualism.Multilingualism.in.corpus=="Bilinguals")

head(byPart)
```

`r nrow(annotations[is.na(annotations$Number.of.participants), ])` corpora have NA in "Number of participants". 
There is data from `r sum(byPart_mono$numpar)` target children in Monolingual corpora.
There is data from `r sum(byPart[is.na(byPart$Bilingualism.Multilingualism.in.corpus),]$numpar)` target children in corpora which have not been classified as Monolingual/Bilingual.
There is data from `r sum(byPart_bili$numpar)` target children in Bilingual corpora.
Overall, the mean number of target children per language is `r mean(byPart$numpar)` with min `r min(byPart$numpar)` and max `r max(byPart$numpar)`.

### Based on "Number.of.participants" annotation column
#### Number of target children per continent

```{r group_by participants_continent}

byPartCont <- annotations %>%
    group_by(continent) %>%
      select(Number.of.participants, continent) %>%
      summarise(numpar = sum(as.numeric(Number.of.participants), na.rm=TRUE)) 

byPartCont %>%      
  ggplot(mapping = aes(y = reorder(continent, numpar), numpar)) + 
      ggtitle("Number of target children per continent") + 
        geom_col()+
           labs(y= "Continents", x = "Number of target children")
head(byPartCont)
```

`r byPartCont[byPartCont$continent=="Europe",]$numpar[1]` target children in Europe, `r byPartCont[byPartCont$continent=="Africa",]$numpar[1]` in Africa,
`r byPartCont[byPartCont$continent=="North America",]$numpar[1]` in North America, `r byPartCont[byPartCont$continent=="Asia",]$numpar[1]`in Asia, `r byPartCont[byPartCont$continent=="Central and South America",]$numpar[1]` in Central and South America.

## Optional chunk merging with childesr for extra information

```{r load_join childes, eval=FALSE}
#d_transcripts <- get_transcripts()
#d_statistics <- get_speaker_statistics()

#mergedChiAnnot <- annotations %>% left_join(d_transcripts)
#mergedChiAnnot <- mergedChiAnnot %>% left_join(n_utt_d)
#mergedChiAnnot <- mergedChiAnnot %>% left_join(n_utt_speaker)
#mergedChiAnnot<-mergedChiAnnot[!(is.na(mergedChiAnnot$n_utt) | mergedChiAnnot$n_utt=="" ), ]

#if ( length(unique(mergedChiAnnot$Corpus)) < nrow(annotations) ) {
#annotations$Corpus[!annotations$Corpus %in% mergedChiAnnot$Corpus]
#  } #print non merged corpora
```

### bilingualism

```{r}
annotations$Bilingualism.Multilingualism.in.corpus[annotations$Bilingualism.Multilingualism.in.corpus %in% c("trilinguism")]<-"yes"
annotations$Bilingualism.Multilingualism.in.corpus<-tolower(annotations$Bilingualism.Multilingualism.in.corpus)
annotations$Bilingualism.Multilingualism.in.corpus[grep("yes",annotations$Bilingualism.Multilingualism.in.corpus)]<-"yes"
annotations$Bilingualism.Multilingualism.in.corpus[grep("no",annotations$Bilingualism.Multilingualism.in.corpus)]<-"no"
annotations$Bilingualism.Multilingualism.in.corpus[annotations$Bilingualism.Multilingualism.in.corpus==""]<-NA

byBilinguals<-group_count(annotations, Bilingualism.Multilingualism.in.corpus)

ggplot(byBilinguals,aes(y=n, x=Bilingualism.Multilingualism.in.corpus)) +
  geom_bar(stat="identity", width=1, color="white") +
  theme_minimal() + 
  ggtitle("Bilingualism in corpus") 
```

