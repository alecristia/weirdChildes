---
title: "childes_weird"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE)
```



```{r libraries, message=FALSE, warning=FALSE}


library(ggplot2)
library(dplyr)
library(tidyr)
library(purrr)
require(scales)
library(stringr)
library(kableExtra)
library(ggpubr)
library(plotly)
library(GGally)

library(RColorBrewer)
myPalette <- brewer.pal(5, "Set2") 


group_count <-function(data_, column_){
data_<- data_ %>%
  group_by({{column_}}) %>%
    count() 
      return(data_)
}

group_select<-function(data_, column_){
data_ <- data_%>%
    group_by(!!column_) %>%
      select(Corpus, !!column_)
data_ <- data_[ order( data_[,3] ),]
return(data_)
}
```

# Load annotations 

```{r load annotations}

annotations<- read.csv("Table for authors - annotations.csv") 
colnames(annotations)[colnames(annotations)=="X..of.children.with.siblings"]<-"Nb.of.children.with.siblings"
colnames(annotations)[colnames(annotations)=="X..of.children.with.older.siblings"]<-"Nb.of.children.with.older.siblings"
colnames(annotations)=gsub("\\.\\..*","",colnames(annotations))
colnames(annotations)[colnames(annotations)=="Our.coding.of"]<-"Our.coding.of.community.type"

annotations$Number.of.participants[annotations$Number.of.participants=="1 or 5"]<-NA
annotations$Number.of.participants[annotations$Number.of.participants=="1 CHI + MOT/FAT/INV"]<-1
annotations$Number.of.participants[annotations$Number.of.participants=="4 CHI + MOTs, some FATs, some SIBs"]<-4
annotations$Number.of.participants=as.numeric(as.character(annotations$Number.of.participants))

annotations$Nb.of.children.with.siblings=as.numeric(as.character(annotations$Nb.of.children.with.siblings))

annotations$Proportion.With.Siblings=annotations$Nb.of.children.with.siblings/annotations$Number.of.participants

#table(annotations$Household.structure)
annotations$Household.structure=tolower(annotations$Household.structure)
annotations$Household.structure[grep("different|diverse|varied",annotations$Household.structure)] <- NA #turn to NA?
annotations$Household.structure[annotations$Household.structure %in% c("nuclear, extended","extended/nuclear")]<-"varied"
annotations$Household.structure[grep("nuclear|nucear|single",annotations$Household.structure)]<-"nuclear" # including single parent
annotations$Household.structure[grep("extended",annotations$Household.structure)]<-"extended"
annotations$Household.structure[annotations$Household.structure==""]<-NA


# Education & SES cleaning
annotations$Education.Naomi[annotations$Education.Naomi==""]<-NA
annotations$Education.Naomi[annotations$Education.Naomi=="4-6"]<-"4-5" #fix typo
annotations$Education.min<-as.numeric(as.character(gsub("-.*","",annotations$Education.Naomi)))
annotations$Education.max<-as.numeric(as.character(gsub(".*-","",annotations$Education.Naomi)))
annotations$Education.mid<-annotations$Education.min+(annotations$Education.max-annotations$Education.min)/2
# 1 = primary
# 2 = secondary school
# 3 = some college
# 4 = university
# 5 = postgraduate
annotations$SES.Naomi[annotations$SES.Naomi==""]<-NA
annotations$SES.min<-gsub("-.*","",annotations$SES.Naomi)
annotations$SES.max<-gsub(".*-","",annotations$SES.Naomi)
annotations$SES.max[grep("upper",annotations$Parental.socioeconomic.status)]<-3




annotations$SES.mid<-as.numeric(as.character(annotations$SES.min))+(as.numeric(as.character(annotations$SES.max))-as.numeric(as.character(annotations$SES.min)))/2


```







```{r group_by inclusion}

# include<- annotations %>%
#   mutate(inclusion=tolower(Inclusion)) %>%
#   mutate(inclusion = ifelse(str_detect(inclusion, "yes"), "yes", "no")) %>%
#   group_by(inclusion) %>%
#   count() 

# ggplot(include,aes(y=n, x=inclusion)) +
#   geom_bar(stat="identity", width=1, color="white") +
#   theme_minimal() + 
#   ggtitle("Corpus inclusion") 

all_annotations <- annotations

annotations <- all_annotations %>%
  filter(Inclusion=="yes")

table(all_annotations$why_exclude)->excl

```


A total of `r nrow(all_annotations)` corpora were initially considered. We excluded  `r excl["Clinical"]` because at least some of the children were not typically developing; `r excl["Diary"]` because they were diary studies;  `r excl["In lab/school"]` because data was collected in the lab or school; `r excl["Not available"]` because data was not available; `r excl["Only one transcribed"]` because only the child or the adult were transcribed; `r excl["Task-oriented"]` because speech was triggered by a task (elicitation, story-telling, etc.); `r excl["Unfamiliar adult"]` because the conversation involved exclusively unfamiliar adults.

After these exclusions, `r nrow(annotations)` remained. The following analyses will continue only on these included corpora.



```{r group_by location_cleaning}

annotations$country <-NA
annotations$continent <-NA


annotations$country[grep("Ireland", annotations$Location)]  <- "Ireland"
annotations$country[grep("England|Arfon area Gwynedd, North Wales|Belfast, Northern Ireland|Nottingham/Manchester, England|England, Brighton|Wales", annotations$Location)]  <- "United Kingdom"
annotations$country[grep("Portugal", annotations$Location)]  <- "Portugal"
annotations$country[grep("Spain|Madrid, Spain ; Tenerife, Canary Islands|Madrid, Spain|Navarra, Spain|Alt penedes, region of catalonia|spain| Lloret de mar|Barcelona| SPAIN|Salamanca|Lugo", annotations$Location)]  <- "Spain"
annotations$country[grep("France|France (Normandy, Marseille, + places visited)", annotations$Location)]  <- "France"
annotations$country[grep("Naples|italy|Roma", annotations$Location)]  <- "Italy"
annotations$country[grep("Switzerland", annotations$Location)]  <- "Switzerland"
annotations$country[grep("Belgium", annotations$Location)]  <- "Belgium"
annotations$country[grep("Germany", annotations$Location)]  <- "Germany"
annotations$country[grep("Netherlands", annotations$Location)]  <- "Netherlands"

#Following the EuroVoc classification https://en.wikipedia.org/wiki/EuroVoc + Italy and Spain and Portugal
annotations$continent[grep("Andorra|Austria|Belgium|France|Germany|Ireland|Italy|Liechtenstein|Luxembourg|Monaco|Netherlands|Portugal|Spain|Switzerland|United Kingdom", annotations$country)]  <- "Western Europe"


annotations$country[grep("PoznaÅ„, Poland", annotations$Location)]  <- "Poland"
annotations$country[grep("Estonia|Tartu, Estonia ; Rapla, Estonia|Southern Estonia|Tartu, Estonia", annotations$Location)]  <- "Estonia"
annotations$country[grep("Hungary", annotations$Location)]  <- "Hungary"
annotations$country[grep("Czech Republic", annotations$Location)]  <- "Czech Republic"
annotations$country[grep("Bucharest, Romania|Romania", annotations$Location)]  <- "Romania"
annotations$country[grep("Serbia", annotations$Location)]  <- "Serbia"
annotations$country[grep("Croatia", annotations$Location)]  <- "Croatia"
annotations$country[grep("Slovenia", annotations$Location)]  <- "Slovenia"

annotations$country[grep("Sweden", annotations$Location)]  <- "Sweden"
annotations$country[grep("Iceland", annotations$Location)]  <- "Iceland"
annotations$country[grep("Norway", annotations$Location)]  <- "Norway"
annotations$country[grep("Denmark", annotations$Location)]  <- "Denmark"

annotations$country[grep("Athens, Greece", annotations$Location)]  <- "Greece"

annotations$country[grep("Moscow, Russia", annotations$Location)]  <- "Russia"

annotations$continent[grep("Poland|Estonia|Hungary|Czech|Romania|Serbia|Croatia|Slovenia|Sweden|Iceland|Norway|Denmark|Greece|Russia", annotations$country)]  <- "Non-Western Europe"


annotations$country[grep("Turkey", annotations$Location)]  <- "Turkey"
annotations$country[grep("Iran", annotations$Location)]  <- "Iran"
annotations$country[grep("Israel|Yahud, Israel", annotations$Location)]  <- "Israel"
annotations$country[grep("Kuwait", annotations$Location)]  <- "Kuwait"

annotations$country[grep("Bombay, India", annotations$Location)]  <- "India"

annotations$country[grep("China", annotations$Location)]  <- "China"

annotations$country[grep("Singapore", annotations$Location)]  <- "Singapore"
annotations$country[grep("Indonesia", annotations$Location)]  <- "Indonesia"
annotations$country[grep("Bangkok, Thailand", annotations$Location)]  <- "Thailand"
annotations$country[grep("Osaka|Tokyo|Nagoya|osaka|Kusatsu City, Shiga Pref", annotations$Location)]  <- "Japan"
annotations$country[grep("Korea", annotations$Location)]  <- "Korea" #NOTE: one corpus just says "Korea", data collected in 2009-2011, assuming it's South Korean
annotations$country[grep("Hong-Kong", annotations$Location)]  <- "Hong Kong"
annotations$country[grep("Taiwan", annotations$Location)]  <- "Taiwan"

annotations$continent[grep("Turkey|Iran|Israel|Kuwait|India|China|Singapore|Indonesia|Thailand|Japan|Korea|Hong Kong|Taiwan", annotations$country)]  <- "Asia"


annotations$country[grep("Papua-New Guinea", annotations$Location)]  <- "Papua New Guinea"
annotations$continent[grep("Papua New Guinea", annotations$country)]  <- "Oceania"


annotations$country[grep("Alexandria, Egypt", annotations$Location)]  <- "Egypt"
annotations$country[grep("Mokhotlong, Lesotho", annotations$Location)]  <- "Lesotho"
annotations$country[grep("South Africa", annotations$Location)]  <- "South Africa"
annotations$continent[grep("Egypt|Lesotho|Africa", annotations$country)]  <- "Africa"


annotations$country[grep("Rio Cuarto, Cordoba, Argentina", annotations$Location)]  <- "Argentina"
annotations$country[grep("Sao Paulo", annotations$Location)]  <- "Brazil"
annotations$country[grep("Mexico", annotations$Location)]  <- "Mexico"
annotations$country[grep("Jamaica", annotations$Location)]  <- "Jamaica"
annotations$continent[grep("Argentina|Brazil|Mexico|Jamaica", annotations$country)]  <- "Latin America"

annotations$country[grep("Michigan, USA|USA, Northern Virginia|California, USA|washington dc|United States|USA|Washington|Maryland|San Fran", annotations$Location)]  <- "United States"
annotations$country[grep("Canada", annotations$Location)]  <- "Canada"
annotations$continent[grep("United States|Canada", annotations$country)]  <- "North America"


#Special cases
annotations$country[grep("Sweden ; Portugal", annotations$Location)]  <- "Sweden & Portugal"
annotations$country[grep("Spain (Lloret de Mar), Hungary (KecskemÃ©t)", annotations$Location)]  <- "Spain & Hungary"
#We are leaving continent as NA (because one country is Western & the other Eastern Europe)


#to check if any left
#annotations[is.na(annotations$country),"Location"]
#annotations[is.na(annotations$continent),"Location"]





```

```{r cleaning language}
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings=="British English"]<-"English"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings=="Catalan (and the variant of Spanish spoken in Barcelona)"]<-"Catalan/Spanish"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings=="Japanese (Kyoto dialect)"]<-"Japanese"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings=="Mandarin Chinese, influenced by the dialects of Jianghuai Mandarin and Cantonese to a minor degree"]<-"Mandarin"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings=="Norwegian (Children: mostly trÃ¸ndersk, parents/care-takers: trÃ¸ndersk, vestnorsk, nordnorsk, austnorsk)"]<-"Norwegian"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings=="Spanish Spain"]<-"Spanish"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings %in% c("European Portuguese","Brazilian Portuguese")]<-"Portuguese (Brazilian or European)"
annotations$Language.or.Languages.spoken.in.recordings[annotations$Language.or.Languages.spoken.in.recordings %in% c("Kuwaiti Arabic","Egyptian Arabic")]<-"Arabic (Egyptian or Kuwaiti)"

lang_temp=levels(factor(annotations$Language.or.Languages.spoken.in.recordings))

#split up &
lang_temp2=NULL
for(x in lang_temp) lang_temp2=c(lang_temp2,unlist(strsplit(x," & ")))
lang_temp2=levels(factor(lang_temp2))

#put mono separately from multi
mono=lang_temp2[grep("/",lang_temp2, invert=T)]
multi=lang_temp2[grep("/",lang_temp2)]

mono_langs=mono[1]
for(x in 2:length(mono)) mono_langs=paste0(mono_langs,", ",mono[x])

multi_langs=multi[1]
for(x in 2:length(multi)) multi_langs=paste0(multi_langs,", ",multi[x])

```


```{r cleaning type}

annotations$Type.of.community.at.the.time.of.the.recordings[is.na(annotations$Type.of.community.at.the.time.of.the.recordings)]<-annotations$Naomi.community.type[is.na(annotations$Type.of.community.at.the.time.of.the.recordings)]

annotations$Type.of.community.at.the.time.of.the.recordings[annotations$Type.of.community.at.the.time.of.the.recordings %in% c("academic","capital city of the Soviet Union","city","industial","industrial ","work-for-pay",
                                                                                                                               "industrial & service &trade activities...","industrial city (3.000.000 inhabitants",
                                                                                                                               "Industrial city (population: around 272,000 inhabitants)",
                                                                                                                               "Mediterranean city of 1.6 million inhabitants",
                                                                                                                               "modern city families, usually both working parents",
                                                                                                                               "Orthodox Jews",
                                                                                                                               "Seaside tourist town",
                                                                                                                               "work-for-pay/industrial","industrial")]<-"urban"

annotations$Type.of.community.at.the.time.of.the.recordings[annotations$Type.of.community.at.the.time.of.the.recordings %in% c("farmer","rural","rural farming village")]<-"rural"

annotations$Type.of.community.at.the.time.of.the.recordings[annotations$Type.of.community.at.the.time.of.the.recordings %in% c("industrial, farmers")]<-"both"
#table(annotations$Type.of.community.at.the.time.of.the.recordings)
```



```{r continent}
byPart<- annotations %>%
  select(Language.or.Languages.spoken.in.recordings, Number.of.participants) %>%
   filter(!is.na(Number.of.participants)) %>%
     group_by(Language.or.Languages.spoken.in.recordings) %>%
       summarise(numpar = sum(as.numeric(Number.of.participants))) 

read.csv("country_iso.csv")->iso_lookup
codes=iso_lookup$Code
iso_lookup$Name<-as.character(iso_lookup$Name)
iso_lookup$Name=gsub(", Islamic Republic of","",iso_lookup$Name)
iso_lookup$Name=gsub("Russian Federation","Russia",iso_lookup$Name)
iso_lookup$Name=gsub(", Province of China","",iso_lookup$Name)
iso_lookup$Name=gsub(", Republic of","",iso_lookup$Name)
iso_lookup$Name=gsub("Congo, the Democratic Republic of the","Democratic Republic of Congo",iso_lookup$Name)

names(codes)<-iso_lookup$Name


annotations$country_WB<-codes[annotations$country]

annotations$country_WB <-factor(annotations$country_WB)
annotations[is.na(annotations$country_WB),"country"]


annotations$continent <-factor(annotations$continent)

```

```{r ancillary data: wdi}
read.csv("wdi-data.csv")->wdi_all

#remove areas
wdi_all=wdi_all[!(wdi_all$country %in% c( "Africa Eastern and Southern" ,"Africa Western and Central",
                                   "Arab World", "Caribbean small states", "Central Europe and the Baltics" ,
                                  "European Union", "Fragile and conflict affected situations",
                                  "OECD members", "West Bank and Gaza",
                                 "Small states"  , "Pacific island small states" 
                                  , "Caribbean small states" , "Other small states",
                                  "Latin America & the Caribbean (IDA & IBRD countries)", "Middle East & North Africa (IDA & IBRD countries)"  ,
 "East Asia & Pacific (IDA & IBRD countries)"     ,      "South Asia (IDA & IBRD)"    ,                        
 "Sub-Saharan Africa (IDA & IBRD countries)"    ,        "Europe & Central Asia (IDA & IBRD countries)" ,
                                  "Turks and Caicos Islands", 
                                  "Euro area"      ,                                     
 "High income"                               ,           "Heavily indebted poor countries (HIPC)"              
, "IBRD only"                                ,            "IDA total"                                           
, "IDA blend"                               ,            "IDA only"                                            
, "Latin America & Caribbean (excluding high income)",
                          "Middle East & North Africa"                          
, "IDA & IBRD total"  ,
                                  "Europe & Central Asia"  ,  "Sub-Saharan Africa (excluding high income)"  ,"Sub-Saharan Africa"    ,                               "Africa Eastern and Southern",
                                  "Least developed countries: UN classification"   ,      "Low income"                                          
, "Lower middle income"      ,                            "Low & middle income"                                 
, "Middle income"          ,                              "Middle East & North Africa (excluding high income)"  
, "Upper middle income"     ,                             "North America"                                       
, "Not classified"                                             
, "East Asia & Pacific", "Pre-demographic dividend" , "Early-demographic dividend" ,"Late-demographic dividend"       , "Post-demographic dividend" , "World","East Asia & Pacific (excluding high income)"  , "Europe & Central Asia (excluding high income)","Latin America & Caribbean","Western Sahara","World" ,"South Asia"
                                  )),]
#cleanup
wdi_all$country[wdi_all$country=="Congo, Dem. Rep."]<-"Democratic Republic of Congo"
wdi_all$country[wdi_all$country=="Congo, Rep."]<-"Congo"
wdi_all$country[wdi_all$country=="Lao PDR"]<-"Laos"
wdi_all$country[wdi_all$country=="Virgin Islands (U.S.)"]<-"United States Virgin Islands"
wdi_all$country<-gsub(", The","",wdi_all$country)
wdi_all$country<-gsub(", RB","",wdi_all$country)
wdi_all$country<-gsub(", Arab Rep.","",wdi_all$country)
wdi_all$country<-gsub(", Islamic Rep.","",wdi_all$country)
wdi_all$country<-gsub(" SAR, China","",wdi_all$country)
wdi_all$country<-gsub("St.","Saint",wdi_all$country,fixed=T)
wdi_all$country<-gsub(", Fed. Sts.","",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Kyrgyz Republic","Kyrgyzstan",wdi_all$country,fixed=T)
wdi_all$country<-gsub(" Darussalam","",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Cabo Verde","Cape Verde",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Czech Republic","Czechia",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Korea, Dem. People's Rep.","North Korea",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Korea, Rep.","South Korea",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Yemen, Rep.","Yemen",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Syrian Arab Republic","Syria",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Russian Federation","Russia",wdi_all$country,fixed=T)
wdi_all$country<-gsub("Slovak Republic","Slovakia",wdi_all$country,fixed=T)

```

```{r ancillary data: owid}
read.csv("economic-inequality-gini-index-OWID-20220208.csv")->gini
gini[gini$Year==2011,]->gini

read.csv("political-regimes-OWID-20220208.csv")->democr
democr[democr$Year==2011,]->democr

read.csv("children-born-per-woman-OWID-20220112.csv")->cpw
cpw[cpw$Year==2011,]->cpw
colnames(cpw)[colnames(cpw)=="Fertility.rate..Select.Gapminder..v12...2017."]<-"Fertility"

merge(gini,democr[,c("Entity","Political.regime")],all=T)->owid
merge(owid,cpw[,c("Entity","Fertility")],all=T)->owid

#clean up
owid=owid[grep("(Urban)",owid$Entity,invert=T),]
owid=owid[grep("(Rural)",owid$Entity,invert=T),]
owid=owid[!(owid$Entity%in% c("World","Palestine/Gaza","Palestine/West Bank","Western Sahara")),]
owid$Political.regime_t<-NA
owid$Political.regime_t[owid$Political.regime==0]<-"closed \n autocracies"
owid$Political.regime_t[owid$Political.regime==1]<-"electoral \n autocracies"
owid$Political.regime_t[owid$Political.regime==2]<-"electoral \n democracies"
owid$Political.regime_t[owid$Political.regime==3]<-"liberal \n democracies"
  
  
# check no missing countries across WB & OWID merge
owid$Entity[!(owid$Entity %in% levels(factor(wdi_all$country)))]
#2 data points lost: Channel Islands & Kosovo
wdi_all$country[!(wdi_all$country %in% levels(factor(owid$Entity)))]


ind_all = merge(wdi_all,owid,by.x="country",by.y="Entity",all=T)
#ind_all$country

#https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv
read.csv("ISO-3166-Countries-with-Regional-Codes.csv")->regions

ind_all=merge(ind_all,regions,by.x="iso2c",by.y="alpha.2")

ind_all$simple_region=ind_all$sub.region
ind_all$simple_region[ind_all$sub.region%in% c("Australia and New Zealand","Melanesia","Micronesia","Polynesia")]<-"Oceania"

ind_all$simple_region[grep("Asia",ind_all$sub.region)]<-"Asia"
ind_all$simple_region[grep("Africa",ind_all$sub.region)]<-"Africa"

ind_all$simple_region[ind_all$sub.region%in% c("Southern Europe","Eastern Europe","Northern Europe")]<-"Non-Western Europe"

ind_all$simple_region[ind_all$country%in% c("Spain","Italy","Portugal")]<-"Western Europe"

ind_all$log_gdp=log(ind_all$NY.GDP.PCAP.PP.KD,10)
ind_all$log2_fert=log(ind_all$Fertility,2)

ind_all$western<-"non-Western"
ind_all$western[ind_all$simple_region %in% c('Western Europe',"Northern America")]<-"Western"
ind_all$western[ind_all$country %in% c('Norway',"Australia","New Zealand","Iceland","Sweden","Denmark")]<-"Western"
ind_all$western[ind_all$country %in% c('Bermuda',"Greenland")]<-"non-Western"
ind_all$western=factor(ind_all$western)
ind = ind_all[ind_all$iso2c %in% levels(annotations$country_WB),]

#final check
#levels(factor(ind_all$country))


annotations=merge(annotations,ind_all,by="country",all.x=T)

```


We had WDI information for `r dim(ind_all)[1]` countries, of which  `r dim(ind)[1]` were present in CHILDES. GDP data was available for `r sum(!is.na(ind_all$NY.GDP.PCAP.PP.KD))` countries overall, and `r sum(!is.na(ind$NY.GDP.PCAP.PP.KD))` countries in CHILDES. Education information was available for `r sum(!is.na(ind_all$SE.SEC.CUAT.UP.ZS))` countries overall, and `r sum(!is.na(ind$SE.SEC.CUAT.UP.ZS))` countries in CHILDES.  Information on the proportion of the population that was urban was available for `r sum(!is.na(ind_all$SP.URB.TOTL.ZS))` countries overall, and `r sum(!is.na(ind$SP.URB.TOTL.ZS))` countries in CHILDES. 

Our World in Data was our source of fertility data and type of political regime, with data available for `r sum(!is.na(cpw$Fertility))` countries overall for the selected year,  `r sum(!is.na(ind$Fertility))` of which were represented in CHILDES. We also drew from Our World in Data information about income inequality within countries via the GINI coefficient, containing `r sum(!is.na(gini$Gini.index))` countries overall for the selected year,  `r sum(!is.na(ind$Gini.index))` of which were represented in CHILDES.

## Confounds

Perhaps it is hard to separate these biases. That is, some readers may have the intuition that Western, Educated, Industrialized, Rich, and Infertile are correlated in the world, and thus it will be hard to fix one without fixing the others and vice versa. Are these aspects confounded in terms of between-country variation?

We looked at 


```{r scatterplot matrix}
# W E I R D
p1 <- ggpairs(ind_all[,c('SE.SEC.CUAT.UP.ZS','SP.URB.TOTL.ZS','log_gdp','Gini.index','log2_fert')], title="Association across vars: all countries",aes(colour = ind_all$western, fill = ind_all$western, alpha = 0.4),columnLabels=c("% compl. high school","% urban","GDP (log 10)","Gini","Fert. (log 2)"), 
               lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.7))) +
  theme_bw()
p1

p <- ggpairs(ind_all[,c('SE.SEC.CUAT.UP.ZS','SP.URB.TOTL.ZS','log_gdp','Gini.index','log2_fert')], title="Association across vars: all countries",columnLabels=c("% compl. high school","% urban","GDP (log 10)","Gini","Fert. (log 2)"), 
               lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.7))) +
  theme_bw()
p


```

```{r western and demo, echo=FALSE, out.height="200%", fig.cap="A nice image."}


ed <- ggplot(ind_all, aes(western, SE.SEC.CUAT.UP.ZS)) + geom_violin() + geom_jitter(height = 0, width = 0.1)  +  ylab("% compl. HS") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

urb <- ggplot(ind_all, aes(western, SP.URB.TOTL.ZS)) + geom_violin() + geom_jitter(height = 0, width = 0.1)  +  ylab("% urban") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

rich <- ggplot(ind_all, aes(western, log_gdp)) + geom_violin() + geom_jitter(height = 0, width = 0.1)  +  ylab("GDP (log 10)") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

gini <- ggplot(ind_all, aes(western, Gini.index)) + geom_violin() + geom_jitter(height = 0, width = 0.1)  +  ylab("Gini.index") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

fert <- ggplot(ind_all, aes(western, log2_fert)) + geom_violin() + geom_jitter(height = 0, width = 0.1) + xlab("Western") +  ylab("Fert. (log 2)") 

# ggarrange( ed, urb, rich, gini, fert,  
#           labels = c("A", "B", "C", "D", "E"),
#           ncol = 1, nrow = 5)


ed_d <- ggplot(ind_all[!is.na(ind_all$Political.regime_t),], aes(Political.regime_t, SE.SEC.CUAT.UP.ZS)) + geom_violin() + geom_jitter(height = 0, width = 0.1)  +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

urb_d <- ggplot(ind_all[!is.na(ind_all$Political.regime_t),], aes(Political.regime_t, SP.URB.TOTL.ZS)) + geom_violin() + geom_jitter(height = 0, width = 0.1)  +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

rich_d <- ggplot(ind_all[!is.na(ind_all$Political.regime_t),], aes(Political.regime_t, log_gdp)) + geom_violin() + geom_jitter(height = 0, width = 0.1)   +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

gini_d <- ggplot(ind_all[!is.na(ind_all$Political.regime_t),], aes(Political.regime_t, Gini.index)) + geom_violin() + geom_jitter(height = 0, width = 0.1)   +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

fert_d <- ggplot(ind_all[!is.na(ind_all$Political.regime_t),], aes(Political.regime_t, log2_fert)) + geom_violin() + geom_jitter(height = 0, width = 0.1) + xlab("Political regime") +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

ggarrange( ed, ed_d,  rich,rich_d,   
          urb, urb_d,  gini, gini_d, fert, fert_d,
           ncol = 2, nrow = 5)

```



## At the level of the population

The samples are varied in geographic terms, with corpora for every populated continent. Specifically, `r sum(annotations$continent=="Africa")` corpora were collected in Africa; `r sum(annotations$continent=="Asia")` in Asia; `r sum(annotations$continent=="Western Europe")` in Western Europe, and a further `r sum(annotations$continent=="Non-Western Europe")` in Non-Western Europe; `r sum(annotations$continent=="North America")` in North America and `r sum(annotations$continent=="Western Europe")` in Latin America. Only `r sum(annotations$continent=="Oceania")` was collected in Oceania.

The samples, however, over-represent richer countries, with relatively educated populations, living mostly in urban settings, and having relatively small families (Figure XX).




```{r rich}

dens_dat=data.frame(rbind(cbind(ind_all$NY.GDP.PCAP.PP.KD[!is.na(ind_all$NY.GDP.PCAP.PP.KD)],0),
               cbind(ind$NY.GDP.PCAP.PP.KD[!is.na(ind$NY.GDP.PCAP.PP.KD)],1) ))
colnames(dens_dat)<-c("GDP.per.capita","in.childes_T")
dens_dat$in.childes=ifelse(dens_dat$in.childes,"CHILDES","all")

rich <- ggplot(dens_dat, aes(x = GDP.per.capita, fill = in.childes)) + geom_density(alpha = 0.5) + theme(legend.position = "none", axis.title.y=element_blank() ) +labs( x = "GDP per capita")

```



```{r Educated}
dens_dat=data.frame(rbind(cbind(ind_all$SE.SEC.CUAT.UP.ZS[!is.na(ind_all$SE.SEC.CUAT.UP.ZS)],0),
               cbind(ind$SE.SEC.CUAT.UP.ZS[!is.na(ind$SE.SEC.CUAT.UP.ZS)],1) ))
colnames(dens_dat)<-c("completed.HS","in.childes_T")
dens_dat$in.childes=ifelse(dens_dat$in.childes,"CHILDES","all")

ed <- ggplot(dens_dat, aes(x = completed.HS, fill = in.childes)) + geom_density(alpha = 0.5) + theme(legend.position = "none", axis.title.y=element_blank() )+labs( x = "Percent completed high school")


```




```{r urban}
dens_dat=data.frame(rbind(cbind(ind_all$SP.URB.TOTL.ZS[!is.na(ind_all$SP.URB.TOTL.ZS)],0),
               cbind(ind$SP.URB.TOTL.ZS[!is.na(ind$SP.URB.TOTL.ZS)],1) ))
colnames(dens_dat)<-c("pc.urban","in.childes_T")
dens_dat$in.childes=ifelse(dens_dat$in.childes,"CHILDES","all")

urb <- ggplot(dens_dat, aes(x = pc.urban, fill = in.childes)) + geom_density(alpha = 0.5) + theme(legend.position = "none", axis.title.y=element_blank() )+labs( x = "Percent urban")

```




```{r Fertility}

dens_dat=data.frame(rbind(cbind(ind_all$Fertility[!is.na(ind_all$Fertility)],0),
               cbind(ind$Fertility[!is.na(ind$Fertility)],1) ))
colnames(dens_dat)<-c("N.children.woman","in.childes_T")
dens_dat$in.childes=ifelse(dens_dat$in.childes,"CHILDES","all")

fert <- ggplot(dens_dat, aes(x = N.children.woman, fill = in.childes)) + geom_density(alpha = 0.5)+ theme(legend.position = "none", axis.title.y=element_blank() ) +labs( x = "Total fertility rate")

```

```{r combined}
#W E I R D
ggarrange(ed, urb, rich, fert,  
          labels = c("A", "B", "C", "D"),
          ncol = 2, nrow = 2)
```


## At the level of the family




A total of `r length(lang_temp)` different languages or language combinations (for bilingual and multilingual children) were reportedly spoken in the corpora. The monolingual samples spoke `r mono_langs`, and the others spoke `r multi_langs`.

### Comparison between families and world data in terms of education, income, urbanity and family size



We then investigated the extent to which samples themselves captured families with diverse educational backgrounds. There were `r sum(is.na(annotations$Education.Naomi))` missing values (`r round(sum(is.na(annotations$Education.Naomi))/length(annotations$Education.Naomi)*100)`%); and `r sum(annotations$Education.Naomi=="diverse",na.rm=T)` were described as diverse, without clarifying the range of education covered. Of the remaining `r sum(!is.na(annotations$Education.min))` samples, `r sum(annotations$Education.min==1 & !is.na(annotations$Education.min))` had at least some parents with primary-level education; `r sum(annotations$Education.min==2 & !is.na(annotations$Education.min))` had parents with secondary school education as the lower bound of the education range, and a further `r sum(annotations$Education.min==3 & !is.na(annotations$Education.min))` had some college as the lower bound. Thus, the majority of the samples (N = `r sum(annotations$Education.min>3 & !is.na(annotations$Education.min))`, `r round(sum(annotations$Education.min>3 & !is.na(annotations$Education.min))/sum(!is.na(annotations$Education.min))*100)`%) portrayed children whose parents had at least a graduate, if not a postgraduate, degree.



Samples were also very homogeneous in terms of the type of community represented: `r sum(annotations$Type.of.community.at.the.time.of.the.recordings=="urban" & !is.na(annotations$Type.of.community.at.the.time.of.the.recordings))` (`r round(sum(annotations$Type.of.community.at.the.time.of.the.recordings=="urban" & !is.na(annotations$Type.of.community.at.the.time.of.the.recordings))/sum(!is.na(annotations$Type.of.community.at.the.time.of.the.recordings))*100)`% of the samples for which this variable was available) were described as industrialized or urban, and one additional one as both rural and urban. Only `r sum(annotations$Type.of.community.at.the.time.of.the.recordings!="urban" & !is.na(annotations$Type.of.community.at.the.time.of.the.recordings))` samples were described as farming or rural.




As for household structure, there was a great deal of missing data, with only `r  sum(!is.na(annotations$Household.structure))` (`r round(sum( !is.na(annotations$Household.structure))/length(annotations$Household.structure)*100)`%) of the samples specified. Among these, `r  sum(annotations$Household.structure=="nuclear" & !is.na(annotations$Household.structure))` (`r round(sum(annotations$Household.structure=="nuclear" & !is.na(annotations$Household.structure))/sum(!is.na(annotations$Household.structure))*100)`%) were nuclear; in `r  sum(annotations$Household.structure=="extended" & !is.na(annotations$Household.structure))` (`r round(sum(annotations$Household.structure=="extended" & !is.na(annotations$Household.structure))/sum(!is.na(annotations$Household.structure))*100)`%) were extended; and in one sample structure varied. 



Most samples were from multi-child families. In fact, only `r sum(annotations$Proportion.With.Siblings==0 & !is.na(annotations$Proportion.With.Siblings))` samples (`r round(sum(annotations$Proportion.With.Siblings==0 & !is.na(annotations$Proportion.With.Siblings))/sum(!is.na(annotations$Proportion.With.Siblings))*100)`% of samples having information on siblings) were constituted exclusively by children with no siblings, and the remaining had at least some siblings. However, it should be born in mind that this variable was missing for `r sum(is.na(annotations$Proportion.With.Siblings))` samples (`r round(sum(is.na(annotations$Proportion.With.Siblings))/length(annotations$Proportion.With.Siblings)*100)`% of included samples).


